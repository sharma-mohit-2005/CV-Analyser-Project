<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATS Score Analyzer - Career Path Finder</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .ats-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .ats-hero {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .file-upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #5a6cf3;
            background-color: #f8f9ff;
        }

        .file-upload-area.dragover {
            border-color: #4f46e5;
            background-color: #eef2ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 20px;
        }

        .results-section {
            display: none;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .score-header {
            padding: 30px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            border: 8px solid rgba(255,255,255,0.3);
        }

        .score-excellent { background-color: #22c55e; }
        .score-good { background-color: #3b82f6; }
        .score-fair { background-color: #f59e0b; }
        .score-poor { background-color: #ef4444; }

        .analysis-tabs {
            display: flex;
            background-color: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-button.active {
            background-color: white;
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }

        .tab-content {
            padding: 30px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .category-score {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f8fafc;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .score-bar {
            width: 200px;
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #22c55e 100%);
            transition: width 0.8s ease;
        }

        .suggestion-item {
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fff7ed;
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
        }

        .suggestion-priority {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .priority-high {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
        }

        .priority-medium {
            background-color: #fff7ed;
            border-left: 4px solid #f59e0b;
        }

        .priority-low {
            background-color: #f0fdf4;
            border-left: 4px solid #22c55e;
        }

        .keyword-tag {
            display: inline-block;
            padding: 5px 12px;
            margin: 5px;
            background-color: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 14px;
        }

        .improvement-section {
            margin-bottom: 30px;
        }

        .improvement-section h3 {
            color: #1f2937;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            padding: 20px;
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            color: #dc2626;
            margin-top: 20px;
        }

        .success-message {
            padding: 20px;
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            color: #166534;
            margin-top: 20px;
        }

        .job-title-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .job-title-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Header styles */
        header {
            background-color: #1f2937;
            padding: 1rem 0;
        }

        .navbar {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            color: #667eea;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .nav-links a:hover {
            background-color: rgba(102, 126, 234, 0.2);
        }

        .nav-links a.active {
            background-color: rgba(102, 126, 234, 0.3);
            color: #667eea;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <header>
        <nav class="navbar">
            <div class="logo">Career Path Finder</div>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/cv-builder">CV Builder</a>
                <a href="/ats-analyzer" class="active">ATS Analyzer</a>
            </div>
        </nav>
    </header>

    <div class="ats-container">
        <!-- Hero Section -->
        <div class="ats-hero">
            <i class="fas fa-robot upload-icon"></i>
            <h1>ATS Score Analyzer</h1>
            <p>Get your CV scored by our AI-powered ATS system and receive personalized improvement suggestions to beat the bots!</p>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
            <h2><i class="fas fa-upload"></i> Upload Your CV for Analysis</h2>
            <form id="atsAnalysisForm" enctype="multipart/form-data">
                <input 
                    type="text" 
                    id="jobTitle" 
                    name="job_title" 
                    placeholder="Target Job Title (Optional - helps with keyword analysis)"
                    class="job-title-input"
                >
                
                <div class="file-upload-area" id="fileUploadArea">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    <h3>Drop your CV here or click to browse</h3>
                    <p>Supports PDF, DOC, DOCX files up to 10MB</p>
                    <input type="file" id="cvFile" name="file" accept=".pdf,.doc,.docx" style="display: none;">
                </div>
                
                <button type="submit" class="analyze-btn" id="analyzeBtn" disabled>
                    <i class="fas fa-search"></i> Analyze ATS Score
                </button>
            </form>
            
            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <div id="successMessage" class="success-message" style="display: none;"></div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <!-- Score Header -->
            <div class="score-header">
                <div class="score-circle" id="scoreCircle">
                    <span id="scoreValue">0</span>
                </div>
                <h2 id="scoreLevel">Analyzing...</h2>
                <p id="scoreDescription">Please wait while we analyze your CV...</p>
            </div>

            <!-- Analysis Tabs -->
            <div class="analysis-tabs">
                <button class="tab-button active" onclick="showTab('overview')">
                    <i class="fas fa-chart-line"></i> Overview
                </button>
                <button class="tab-button" onclick="showTab('categories')">
                    <i class="fas fa-tasks"></i> Categories
                </button>
                <button class="tab-button" onclick="showTab('keywords')">
                    <i class="fas fa-tags"></i> Keywords
                </button>
                <button class="tab-button" onclick="showTab('suggestions')">
                    <i class="fas fa-lightbulb"></i> Suggestions
                </button>
                <button class="tab-button" onclick="showTab('improvement')">
                    <i class="fas fa-rocket"></i> Action Plan
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Overview Tab -->
                <div id="overview" class="tab-panel active">
                    <h3>ATS Compatibility Overview</h3>
                    <div id="overviewContent">
                        <div class="improvement-section">
                            <h4><i class="fas fa-star"></i> Your Strengths</h4>
                            <div id="strengthsList"></div>
                        </div>
                        <div class="improvement-section">
                            <h4><i class="fas fa-exclamation-triangle"></i> Areas for Improvement</h4>
                            <div id="improvementAreasList"></div>
                        </div>
                    </div>
                </div>

                <!-- Categories Tab -->
                <div id="categories" class="tab-panel">
                    <h3>Category Breakdown</h3>
                    <div id="categoriesContent"></div>
                </div>

                <!-- Keywords Tab -->
                <div id="keywords" class="tab-panel">
                    <h3>Keyword Analysis</h3>
                    <div id="keywordsContent"></div>
                </div>

                <!-- Suggestions Tab -->
                <div id="suggestions" class="tab-panel">
                    <h3>Improvement Suggestions</h3>
                    <div id="suggestionsContent"></div>
                </div>

                <!-- Improvement Plan Tab -->
                <div id="improvement" class="tab-panel">
                    <h3>Your Personalized Action Plan</h3>
                    <div id="improvementContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div style="text-align: center; color: white;">
            <div class="loading-spinner"></div>
            <p style="margin-top: 20px; font-size: 18px;">Analyzing your CV for ATS compatibility...</p>
        </div>
    </div>

    <script>
        // Global variables
        let analysisResults = null;

        // Initialize file upload functionality
        document.addEventListener('DOMContentLoaded', function() {
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('cvFile');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const form = document.getElementById('atsAnalysisForm');

            // File upload area click handler
            fileUploadArea.addEventListener('click', () => {
                fileInput.click();
            });

            // File input change handler
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    updateFileUploadUI(file);
                    analyzeBtn.disabled = false;
                }
            });

            // Drag and drop handlers
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });

            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    fileInput.files = files;
                    updateFileUploadUI(file);
                    analyzeBtn.disabled = false;
                }
            });

            // Form submission
            form.addEventListener('submit', handleFormSubmission);
        });

        function updateFileUploadUI(file) {
            const fileUploadArea = document.getElementById('fileUploadArea');
            fileUploadArea.innerHTML = `
                <i class="fas fa-file-alt upload-icon" style="color: #22c55e;"></i>
                <h3 style="color: #22c55e;">File Selected: ${file.name}</h3>
                <p>File size: ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                <p style="font-size: 14px; color: #666;">Click to select a different file</p>
            `;
        }

        async function handleFormSubmission(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const file = formData.get('file');
            
            if (!file || file.size === 0) {
                showError('Please select a CV file to analyze.');
                return;
            }

            showLoading(true);
            hideMessages();

            try {
                const response = await fetch('http://127.0.0.1:5000/api/ats-analysis', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    analysisResults = data.ats_analysis;
                    displayResults(analysisResults);
                    showSuccess('CV analysis completed successfully!');
                } else {
                    showError(data.error || 'Failed to analyze CV. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('Network error. Please check your connection and try again.');
            } finally {
                showLoading(false);
            }
        }

        function displayResults(results) {
            const analysis = results.analysis;
            const improvementPlan = results.improvement_plan;

            // Update score display
            updateScoreDisplay(analysis);

            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });

            // Update all tabs
            updateOverviewTab(analysis);
            updateCategoriesTab(analysis);
            updateKeywordsTab(analysis);
            updateSuggestionsTab(analysis);
            updateImprovementTab(improvementPlan);
        }

        function updateScoreDisplay(analysis) {
            const scoreValue = document.getElementById('scoreValue');
            const scoreLevel = document.getElementById('scoreLevel');
            const scoreDescription = document.getElementById('scoreDescription');
            const scoreCircle = document.getElementById('scoreCircle');

            const score = analysis.overall_score;
            const interpretation = analysis.score_interpretation;

            scoreValue.textContent = score;
            scoreLevel.textContent = interpretation.level + ' ATS Score';
            scoreDescription.textContent = interpretation.description;

            // Update circle color based on score
            scoreCircle.className = 'score-circle';
            if (score >= 85) scoreCircle.classList.add('score-excellent');
            else if (score >= 70) scoreCircle.classList.add('score-good');
            else if (score >= 55) scoreCircle.classList.add('score-fair');
            else scoreCircle.classList.add('score-poor');
        }

        function updateOverviewTab(analysis) {
            const strengthsList = document.getElementById('strengthsList');
            const improvementAreasList = document.getElementById('improvementAreasList');

            // Display strengths
            if (analysis.strengths.length > 0) {
                strengthsList.innerHTML = analysis.strengths.map(strength => 
                    `<div class="suggestion-item" style="background-color: #f0fdf4; border-left-color: #22c55e;">
                        <i class="fas fa-check-circle" style="color: #22c55e; margin-right: 10px;"></i>
                        ${strength}
                    </div>`
                ).join('');
            } else {
                strengthsList.innerHTML = '<p>No specific strengths identified. Focus on the improvement areas below.</p>';
            }

            // Display improvement areas
            if (analysis.improvement_areas.length > 0) {
                improvementAreasList.innerHTML = analysis.improvement_areas.map(area => 
                    `<div class="suggestion-item">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; margin-right: 10px;"></i>
                        ${area}
                    </div>`
                ).join('');
            } else {
                improvementAreasList.innerHTML = '<p style="color: #22c55e;">Great! No major improvement areas identified.</p>';
            }
        }

        function updateCategoriesTab(analysis) {
            const categoriesContent = document.getElementById('categoriesContent');
            const categories = analysis.category_scores;

            const categoryLabels = {
                'format': 'Format & Structure',
                'keywords': 'Keywords & Terminology',
                'structure': 'CV Organization',
                'content': 'Content Quality',
                'length': 'Length & Readability',
                'readability': 'Text Readability'
            };

            const categoryIcons = {
                'format': 'fas fa-file-alt',
                'keywords': 'fas fa-tags',
                'structure': 'fas fa-sitemap',
                'content': 'fas fa-star',
                'length': 'fas fa-ruler',
                'readability': 'fas fa-eye'
            };

            categoriesContent.innerHTML = Object.entries(categories).map(([category, score]) => `
                <div class="category-score">
                    <div style="display: flex; align-items: center;">
                        <i class="${categoryIcons[category]}" style="margin-right: 15px; color: #667eea; font-size: 20px;"></i>
                        <div>
                            <strong>${categoryLabels[category]}</strong>
                            <div style="font-size: 14px; color: #666; margin-top: 5px;">${getCategoryDescription(category)}</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">${Math.round(score)}/100</div>
                        <div class="score-bar">
                            <div class="score-fill" style="width: ${score}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateKeywordsTab(analysis) {
            const keywordsContent = document.getElementById('keywordsContent');
            const keywords = analysis.keyword_analysis;

            keywordsContent.innerHTML = `
                <div class="improvement-section">
                    <h4><i class="fas fa-code"></i> Technical Skills Found (${keywords.technical_skills_count})</h4>
                    <div>
                        ${keywords.technical_skills.map(skill => 
                            `<span class="keyword-tag">${skill}</span>`
                        ).join('')}
                        ${keywords.technical_skills.length === 0 ? '<p>No technical skills detected. Consider adding relevant programming languages, tools, or technologies.</p>' : ''}
                    </div>
                </div>

                <div class="improvement-section">
                    <h4><i class="fas fa-users"></i> Soft Skills Found (${keywords.soft_skills_count})</h4>
                    <div>
                        ${keywords.soft_skills.map(skill => 
                            `<span class="keyword-tag" style="background-color: #f59e0b;">${skill}</span>`
                        ).join('')}
                        ${keywords.soft_skills.length === 0 ? '<p>No soft skills detected. Consider adding skills like leadership, communication, teamwork.</p>' : ''}
                    </div>
                </div>

                <div class="improvement-section">
                    <h4><i class="fas fa-bolt"></i> Action Verbs Found (${keywords.action_verbs_count})</h4>
                    <div>
                        ${keywords.action_verbs.map(verb => 
                            `<span class="keyword-tag" style="background-color: #22c55e;">${verb}</span>`
                        ).join('')}
                        ${keywords.action_verbs.length === 0 ? '<p>No strong action verbs detected. Use words like "achieved", "developed", "led", "improved".</p>' : ''}
                    </div>
                </div>

                <div class="improvement-section">
                    <h4><i class="fas fa-industry"></i> Industry Terms Found (${keywords.industry_terms_count})</h4>
                    <div>
                        ${keywords.industry_terms.map(term => 
                            `<span class="keyword-tag" style="background-color: #8b5cf6;">${term}</span>`
                        ).join('')}
                        ${keywords.industry_terms.length === 0 ? '<p>No industry-specific terms detected. Add terms relevant to your field.</p>' : ''}
                    </div>
                </div>
            `;
        }

        function updateSuggestionsTab(analysis) {
            const suggestionsContent = document.getElementById('suggestionsContent');
            
            if (analysis.suggestions.length > 0) {
                suggestionsContent.innerHTML = analysis.suggestions.map((suggestion, index) => `
                    <div class="suggestion-item">
                        <strong>Suggestion ${index + 1}:</strong>
                        <p style="margin: 10px 0 0 0;">${suggestion}</p>
                    </div>
                `).join('');
            } else {
                suggestionsContent.innerHTML = '<p style="color: #22c55e; text-align: center; padding: 40px;">Excellent! Your CV looks great and no immediate suggestions are needed.</p>';
            }
        }

        function updateImprovementTab(improvementPlan) {
            const improvementContent = document.getElementById('improvementContent');

            improvementContent.innerHTML = `
                <div class="improvement-section">
                    <h4><i class="fas fa-exclamation-circle"></i> Priority Actions</h4>
                    ${improvementPlan.priority_actions.map(action => `
                        <div class="suggestion-priority priority-high">
                            <strong>High Priority:</strong> ${action}
                        </div>
                    `).join('')}
                </div>

                <div class="improvement-section">
                    <h4><i class="fas fa-clock"></i> Quick Fixes</h4>
                    ${improvementPlan.quick_fixes.map(fix => `
                        <div class="suggestion-priority priority-medium">
                            <strong>Quick Fix:</strong> ${fix}
                        </div>
                    `).join('')}
                </div>

                <div class="improvement-section">
                    <h4><i class="fas fa-chart-line"></i> Long-term Improvements</h4>
                    ${improvementPlan.long_term_improvements.map(improvement => `
                        <div class="suggestion-priority priority-low">
                            <strong>Long-term:</strong> ${improvement}
                        </div>
                    `).join('')}
                </div>

                ${improvementPlan.keyword_suggestions.length > 0 ? `
                <div class="improvement-section">
                    <h4><i class="fas fa-tags"></i> Keyword Enhancement</h4>
                    ${improvementPlan.keyword_suggestions.map(suggestion => `
                        <div class="suggestion-item">
                            ${suggestion}
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                <div class="improvement-section">
                    <h4><i class="fas fa-robot"></i> ATS Optimization Tips</h4>
                    ${improvementPlan.ats_optimization_tips.map(tip => `
                        <div class="suggestion-item" style="background-color: #f0f9ff; border-left-color: #3b82f6;">
                            <i class="fas fa-lightbulb" style="color: #3b82f6; margin-right: 10px;"></i>
                            ${tip}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function getCategoryDescription(category) {
            const descriptions = {
                'format': 'File format, special characters, and ATS readability',
                'keywords': 'Relevant industry keywords and skills',
                'structure': 'Section organization and essential information',
                'content': 'Quality of achievements and quantifiable results',
                'length': 'Appropriate CV length and content density',
                'readability': 'Text clarity and sentence structure'
            };
            return descriptions[category] || '';
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }
    </script>
</body>
</html>
